<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE PLANNER å­¸ç¿’ç¶²</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      margin: 0; 
      font-family: Arial, Helvetica, sans-serif; 
      background: #f5f7fa;
      overflow-x: hidden;
    }
    
    /* Header æ¨£å¼ - å¾ index è¤‡è£½ */
    header {
      background: #4a6cf7;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .nav-left {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .logo-link {
      display: flex;
      align-items: center;
      margin-right: 12px;
      text-decoration: none;
      color: white;
      font-weight: bold;
      font-size: 18px;
    }
    .nav-right {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    /* å°è¦½åˆ—æŒ‰éˆ•æ¨£å¼ */
    .nav-btn {
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.85);
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    .nav-btn:active {
      transform: translateY(0);
    }

    /* è¨»å†Š/ç™»å…¥æŒ‰éˆ• */
    .auth-btn {
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .register-btn {
      background: transparent;
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.8);
    }
    .register-btn:hover {
      background: white;
      color: #4a6cf7;
      border-color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    .login-btn {
      background: white;
      color: #4a6cf7;
    }
    .login-btn:hover {
      background: rgba(255, 255, 255, 0.9);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    .auth-btn:active {
      transform: translateY(0);
    }

    /* ä¸»å®¹å™¨ - å·¦å³åˆ†å‰² */
    .main-container {
      display: flex;
      height: calc(100vh - 68px);
      overflow: hidden;
    }

    /* å·¦å´æŠ€èƒ½æ¨¹å€åŸŸ */
    .skill-tree-section {
      flex: 0 0 50%;
      background: 
        repeating-linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.05) 0px,
          rgba(0, 0, 0, 0.05) 2px,
          transparent 2px,
          transparent 4px
        ),
        repeating-linear-gradient(
          90deg,
          rgba(0, 0, 0, 0.05) 0px,
          rgba(0, 0, 0, 0.05) 2px,
          transparent 2px,
          transparent 4px
        ),
        linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      overflow-y: auto;
      padding: 30px 20px;
      position: relative;
      image-rendering: pixelated;
    }

    /* å³å´å…§å®¹å€åŸŸ */
    .content-section {
      flex: 0 0 50%;
      background: white;
      overflow-y: auto;
      padding: 30px;
      display: flex;
      flex-direction: column;
    }

    .tree-title {
      text-align: center;
      color: #ffd700;
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 40px;
      text-shadow: 
        2px 2px 0px #8b4513,
        -1px -1px 0px rgba(0,0,0,0.5),
        0 0 20px rgba(255, 215, 0, 0.5);
      font-family: 'Courier New', monospace;
      letter-spacing: 2px;
    }

    /* SVG é€£æ¥ç·šå®¹å™¨ */
    .connections-svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    /* æŠ€èƒ½æ¨¹ - å¾ä¸‹å¾€ä¸Š */
    .skill-tree {
      position: relative;
      display: flex;
      flex-direction: column-reverse;
      gap: 100px;
      z-index: 2;
      padding-bottom: 30px;
    }

    .skill-layer {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    /* ä¸»ç·šå±…ä¸­ */
    .mainline {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* æ”¯ç·šåŒ…å«ä¸»ç·š+å´é‚Šæ”¯ç·š */
    .sideline-layer {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 180px;
    }

    .side-branches {
      display: flex;
      flex-direction: column;
      gap: 60px;
    }

    /* æŠ€èƒ½ç¯€é» */
    .skill-node {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* ä¸»ç·šæŠ€èƒ½åœ“åœˆ - è¼ƒå¤§ */
    .skill-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 0 0 4px rgba(0, 0, 0, 0.3),
        0 8px 20px rgba(0,0,0,0.6),
        inset 0 2px 10px rgba(255,255,255,0.3);
      border: 6px solid transparent;
      position: relative;
      font-size: 13px;
      font-weight: bold;
      color: white;
      text-align: center;
      padding: 12px;
      line-height: 1.2;
      font-family: 'Courier New', monospace;
      text-shadow: 
        1px 1px 0 rgba(0,0,0,0.8),
        -1px -1px 0 rgba(0,0,0,0.8);
      image-rendering: pixelated;
    }

    /* å…«ä½å…ƒé¢¨æ ¼é‚Šæ¡†æ•ˆæœ */
    .skill-circle::before {
      content: '';
      position: absolute;
      top: -8px;
      left: -8px;
      right: -8px;
      bottom: -8px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.1);
      pointer-events: none;
    }

    /* æ”¯ç·šæŠ€èƒ½åœ“åœˆ - è¼ƒå° */
    .skill-circle.side {
      width: 90px;
      height: 90px;
      font-size: 11px;
      padding: 8px;
      border-width: 5px;
    }

    /* é–å®šç‹€æ…‹ - çŸ³é ­è³ªæ„Ÿ */
    .skill-circle.locked {
      background: 
        linear-gradient(135deg, 
          #4a5568 0%, 
          #2d3748 25%,
          #4a5568 50%,
          #2d3748 75%,
          #4a5568 100%);
      background-size: 200% 200%;
      cursor: not-allowed;
      opacity: 0.7;
      border-color: #1a202c;
      box-shadow: 
        0 0 0 4px rgba(0, 0, 0, 0.5),
        0 6px 15px rgba(0,0,0,0.7),
        inset 0 2px 5px rgba(0,0,0,0.5);
    }

    .skill-circle.locked::after {
      content: 'ğŸ”’';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      opacity: 0.6;
      filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.8));
    }

    /* ä¸»ç·šå¯ç”¨ç‹€æ…‹ - é‡‘è‰²å¯¶ç®±é¢¨æ ¼ */
    .skill-circle.available {
      background: 
        linear-gradient(135deg, 
          #ffd700 0%, 
          #ffed4e 20%,
          #ffd700 40%,
          #f4a742 60%,
          #ffd700 80%,
          #ffed4e 100%);
      background-size: 200% 200%;
      border-color: #ffed4e;
      animation: shine-main 3s ease-in-out infinite, pulse-main 2s infinite;
      box-shadow: 
        0 0 0 4px rgba(139, 69, 19, 0.8),
        0 0 20px rgba(255, 215, 0, 0.8),
        0 8px 25px rgba(0,0,0,0.6),
        inset 0 2px 10px rgba(255,255,255,0.5);
    }

    /* æ”¯ç·šå¯ç”¨ç‹€æ…‹ - ç´«è‰²é­”æ³•é¢¨æ ¼ */
    .skill-circle.side.available {
      background: 
        linear-gradient(135deg, 
          #9333ea 0%, 
          #c084fc 25%,
          #a855f7 50%,
          #7c3aed 75%,
          #9333ea 100%);
      background-size: 200% 200%;
      border-color: #c084fc;
      animation: shine-side 3s ease-in-out infinite, pulse-side 2s infinite;
      box-shadow: 
        0 0 0 4px rgba(88, 28, 135, 0.8),
        0 0 20px rgba(168, 85, 247, 0.8),
        0 6px 20px rgba(0,0,0,0.6),
        inset 0 2px 10px rgba(255,255,255,0.3);
    }

    /* ä¸»ç·šå·²å®Œæˆ - é–ƒäº®é‡‘è‰² */
    .skill-circle.completed {
      background: 
        radial-gradient(circle at 30% 30%, 
          #fff9c4 0%,
          #ffd700 30%,
          #f4a742 70%,
          #d4a017 100%);
      border-color: #fff9c4;
      box-shadow: 
        0 0 0 4px rgba(139, 69, 19, 0.9),
        0 0 30px rgba(255, 215, 0, 1),
        0 8px 25px rgba(0,0,0,0.6),
        inset 0 2px 15px rgba(255,255,255,0.7);
      animation: sparkle 2s ease-in-out infinite;
    }

    .skill-circle.completed::after {
      content: 'âœ“';
      position: absolute;
      top: -10px;
      right: -10px;
      width: 32px;
      height: 32px;
      background: radial-gradient(circle, #10b981 0%, #059669 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
      border: 3px solid #d1fae5;
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.8);
    }

    /* æ”¯ç·šå·²å®Œæˆ - é–ƒäº®ç´«è‰² */
    .skill-circle.side.completed {
      background: 
        radial-gradient(circle at 30% 30%, 
          #e9d5ff 0%,
          #c084fc 30%,
          #9333ea 70%,
          #6b21a8 100%);
      border-color: #e9d5ff;
      box-shadow: 
        0 0 0 4px rgba(88, 28, 135, 0.9),
        0 0 25px rgba(168, 85, 247, 1),
        0 6px 20px rgba(0,0,0,0.6),
        inset 0 2px 15px rgba(255,255,255,0.5);
      animation: sparkle 2s ease-in-out infinite;
    }

    .skill-circle.side.completed::after {
      width: 28px;
      height: 28px;
      font-size: 18px;
    }

    .skill-circle:not(.locked):hover {
      transform: scale(1.2) translateY(-8px) rotate(5deg);
      box-shadow: 
        0 0 0 4px rgba(0, 0, 0, 0.3),
        0 12px 40px rgba(255, 215, 0, 0.8),
        0 0 50px rgba(255, 215, 0, 0.6);
      filter: brightness(1.2);
    }

    @keyframes pulse-main {
      0%, 100% { 
        box-shadow: 
          0 0 0 4px rgba(139, 69, 19, 0.8),
          0 0 20px rgba(255, 215, 0, 0.6),
          0 8px 25px rgba(0,0,0,0.6);
      }
      50% { 
        box-shadow: 
          0 0 0 4px rgba(139, 69, 19, 0.8),
          0 0 35px rgba(255, 215, 0, 1),
          0 10px 30px rgba(0,0,0,0.6);
      }
    }

    @keyframes pulse-side {
      0%, 100% { 
        box-shadow: 
          0 0 0 4px rgba(88, 28, 135, 0.8),
          0 0 20px rgba(168, 85, 247, 0.6),
          0 6px 20px rgba(0,0,0,0.6);
      }
      50% { 
        box-shadow: 
          0 0 0 4px rgba(88, 28, 135, 0.8),
          0 0 35px rgba(168, 85, 247, 1),
          0 8px 25px rgba(0,0,0,0.6);
      }
    }

    @keyframes shine-main {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes shine-side {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes sparkle {
      0%, 100% { 
        filter: brightness(1) drop-shadow(0 0 5px rgba(255,255,255,0.5)); 
      }
      50% { 
        filter: brightness(1.3) drop-shadow(0 0 15px rgba(255,255,255,0.8)); 
      }
    }

    /* å³å´å…§å®¹å€åŸŸ */
    .content-header {
      margin-bottom: 25px;
    }

    .content-title {
      font-size: 28px;
      font-weight: bold;
      color: #1f2937;
      margin-bottom: 10px;
    }

    .content-subtitle {
      font-size: 16px;
      color: #6b7280;
    }

    /* åˆå§‹æç¤º */
    .welcome-message {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100%;
      color: #9ca3af;
      text-align: center;
    }

    .welcome-icon {
      font-size: 80px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .welcome-text {
      font-size: 20px;
      font-weight: 500;
    }

    /* å½±ç‰‡å€åŸŸ */
    .video-container {
      background: #000;
      border-radius: 12px;
      margin-bottom: 20px;
      aspect-ratio: 16/9;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 18px;
    }

    .video-placeholder {
      text-align: center;
      padding: 40px;
    }

    .continue-btn {
      background: #4a6cf7;
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .continue-btn:hover {
      background: #3b5ad6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(74, 108, 247, 0.3);
    }

    /* è©•é‡ä»‹é¢ */
    .quiz-container {
      display: none;
      flex: 1;
    }

    .quiz-container.active {
      display: flex;
      flex-direction: column;
    }

    .question {
      margin-bottom: 25px;
    }

    .question-text {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #1f2937;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .option {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      padding: 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .option:hover {
      border-color: #4a6cf7;
      background: #eff6ff;
    }

    .option.selected {
      border-color: #4a6cf7;
      background: #dbeafe;
    }

    .option.correct {
      border-color: #10b981;
      background: #d1fae5;
    }

    .option.wrong {
      border-color: #ef4444;
      background: #fee2e2;
    }

    .submit-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 20px;
    }

    .submit-btn:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .submit-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .result-message {
      margin-top: 20px;
      padding: 18px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
    }

    .result-message.success {
      background: #d1fae5;
      color: #065f46;
    }

    .result-message.fail {
      background: #fee2e2;
      color: #991b1b;
    }

    /* åœ–ä¾‹ */
    .legend {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.95);
      padding: 15px 18px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      z-index: 100;
    }

    .legend-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #1f2937;
      font-size: 14px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 13px;
      color: #4b5563;
    }

    .legend-circle {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 3px solid transparent;
      flex-shrink: 0;
    }

    .legend-circle.main {
      width: 28px;
      height: 28px;
      border-width: 3px;
    }

    .legend-circle.locked { 
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      border-color: #9ca3af;
      opacity: 0.5;
    }
    .legend-circle.main.available { 
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border-color: #fde047;
    }
    .legend-circle.side.available { 
      background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
      border-color: #c084fc;
    }
    .legend-circle.main.completed { 
      background: linear-gradient(135deg, #fde047 0%, #facc15 100%);
      border-color: #fef08a;
    }
    .legend-circle.side.completed { 
      background: linear-gradient(135deg, #c084fc 0%, #a855f7 100%);
      border-color: #e9d5ff;
    }

    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 1200px) {
      .main-container {
        flex-direction: column;
        height: auto;
      }
      .skill-tree-section,
      .content-section {
        flex: 1 1 100%;
        min-height: 50vh;
      }
    }

    /* æ‡¸æµ®è¦–çª—é®ç½© */
    .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    animation: fadeIn 0.3s ease;
    }

    .modal-overlay.active {
    display: flex;
    }

    @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
    }

    /* æ‡¸æµ®è¦–çª—å…§å®¹ */
    .modal-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    max-width: 500px;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: modalPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes modalPop {
    0% {
        transform: scale(0.5) rotate(-5deg);
        opacity: 0;
    }
    100% {
        transform: scale(1) rotate(0);
        opacity: 1;
    }
    }

    .modal-icon {
    font-size: 100px;
    margin-bottom: 20px;
    animation: bounce 1s infinite;
    }

    @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
    }

    .modal-title {
    font-size: 36px;
    font-weight: bold;
    color: white;
    margin-bottom: 15px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .modal-message {
    font-size: 20px;
    color: rgba(255, 255, 255, 0.95);
    margin-bottom: 30px;
    line-height: 1.6;
    }

    .modal-btn {
    background: white;
    color: #667eea;
    border: none;
    padding: 15px 40px;
    border-radius: 10px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .modal-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    /* ç…™ç«ç‰¹æ•ˆ */
    .firework {
    position: absolute;
    width: 5px;
    height: 5px;
    border-radius: 50%;
    animation: fireworkAnim 1s ease-out forwards;
    }

    @keyframes fireworkAnim {
    0% {
        transform: translate(0, 0);
        opacity: 1;
    }
    100% {
        transform: translate(var(--tx), var(--ty));
        opacity: 0;
    }
    }

    /* æ˜Ÿæ˜Ÿé£„è½ç‰¹æ•ˆ */
    .star {
    position: absolute;
    font-size: 20px;
    animation: starFall 2s ease-in-out infinite;
    opacity: 0;
    }

    @keyframes starFall {
    0% {
        top: -20px;
        opacity: 0;
    }
    50% {
        opacity: 1;
    }
    100% {
        top: 100%;
        opacity: 0;
    }
    }

    /* å¤±æ•—æ‡¸æµ®è¦–çª— */
    .modal-content.fail {
    background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
    }

    .modal-content.fail .modal-icon {
    animation: shake 0.5s infinite;
    }

    @keyframes shake {
    0%, 100% { transform: translateX(0) rotate(0deg); }
    25% { transform: translateX(-10px) rotate(-5deg); }
    75% { transform: translateX(10px) rotate(5deg); }
    }

    /* é›¨æ»´ç‰¹æ•ˆ */
    .raindrop {
    position: absolute;
    width: 2px;
    height: 20px;
    background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.6));
    animation: rainFall 1s linear infinite;
    opacity: 0.7;
    }

    @keyframes rainFall {
    0% {
        top: -20px;
        opacity: 0.7;
    }
    100% {
        top: 100%;
        opacity: 0;
    }
    }

    /* ç¢ç‰‡ç‰¹æ•ˆ */
    .fragment {
    position: absolute;
    width: 10px;
    height: 10px;
    background: rgba(255, 255, 255, 0.8);
    animation: fragmentFall 2s ease-in forwards;
    }

    @keyframes fragmentFall {
    0% {
        transform: translate(0, 0) rotate(0deg);
        opacity: 1;
    }
    100% {
        transform: translate(var(--fx), var(--fy)) rotate(var(--fr));
        opacity: 0;
    }
    }
  </style>
</head>
<body>
    <header>
    <nav class="nav-left">
        <a href="index.html" class="logo-link">
        <img src="assets/logo.png" alt="Logo" style="height:40px; width:auto; image-rendering:pixelated;" onerror="this.style.display='none'">
        </a>
        <button class="nav-btn" onclick="location.href='index.html'">ä¸»ç·šä»»å‹™</button>
        <button class="nav-btn">æ”¯ç·šä»»å‹™</button>
        <button class="nav-btn">å­¸ç¿’ç´€éŒ„</button>
    </nav>

    <!-- ğŸ”¥ åŠ å…¥ id="headerNav" -->
    <div class="nav-right" id="headerNav">
        <button class="auth-btn register-btn">è¨»å†Š</button>
        <button class="auth-btn login-btn">ç™»å…¥</button>
    </div>
    </header>

  <div class="main-container">
    <!-- å·¦å´ï¼šæŠ€èƒ½æ¨¹ -->
    <div class="skill-tree-section">
      <div class="tree-title"> App Inventor éŠæˆ²è£½ä½œ</div>
      
      <!-- SVG é€£æ¥ç·š -->
      <svg class="connections-svg" id="connectionsSvg"></svg>

      <div class="skill-tree" id="skillTree">
        <!-- ç¬¬ä¸€å±¤ï¼ˆæœ€åº•å±¤ï¼‰ï¼šåŸºç¤ä»‹ç´¹ -->
        <div class="skill-layer">
          <div class="mainline">
            <div class="skill-node" data-id="1">
              <div class="skill-circle available" onclick="openSkill(1)">
                åŸºç¤ä»‹ç´¹
              </div>
            </div>
          </div>
        </div>

        <!-- ç¬¬äºŒå±¤ï¼šä»‹é¢è¨­è¨ˆ + éŸ³æ•ˆè¨­è¨ˆï¼ˆæ”¯ç·šï¼‰ -->
        <div class="skill-layer">
          <div class="sideline-layer">
            <div class="side-branches">
              <div class="skill-node" data-id="3">
                <div class="skill-circle side locked" onclick="openSkill(3)">
                  éŸ³æ•ˆè¨­è¨ˆ
                </div>
              </div>
            </div>
            
            <div class="mainline">
              <div class="skill-node" data-id="2">
                <div class="skill-circle locked" onclick="openSkill(2)">
                  ä»‹é¢è¨­è¨ˆ
                </div>
              </div>
            </div>
            
            <div style="width: 85px;"></div>
          </div>
        </div>

        <!-- ç¬¬ä¸‰å±¤ï¼šç¨‹å¼é‚è¼¯ + è³‡æ–™å„²å­˜ï¼ˆæ”¯ç·šï¼‰ -->
        <div class="skill-layer">
          <div class="sideline-layer">
            <div style="width: 85px;"></div>
            
            <div class="mainline">
              <div class="skill-node" data-id="4">
                <div class="skill-circle locked" onclick="openSkill(4)">
                  ç¨‹å¼é‚è¼¯
                </div>
              </div>
            </div>
            
            <div class="side-branches">
              <div class="skill-node" data-id="5">
                <div class="skill-circle side locked" onclick="openSkill(5)">
                  è³‡æ–™å„²å­˜
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ç¬¬å››å±¤ï¼šéŠæˆ²è£½ä½œ + é€²éšéŸ³æ•ˆï¼ˆæ”¯ç·šçš„æ”¯ç·šï¼‰ -->
        <div class="skill-layer">
          <div class="sideline-layer">
            <div class="side-branches">
              <div class="skill-node" data-id="8">
                <div class="skill-circle side locked" onclick="openSkill(8)">
                  é€²éšéŸ³æ•ˆ
                </div>
              </div>
            </div>
            
            <div class="mainline">
              <div class="skill-node" data-id="6">
                <div class="skill-circle locked" onclick="openSkill(6)">
                  éŠæˆ²è£½ä½œ
                </div>
              </div>
            </div>
            
            <div style="width: 85px;"></div>
          </div>
        </div>

        <!-- ç¬¬äº”å±¤ï¼šå°ˆé¡Œç™¼è¡¨ -->
        <div class="skill-layer">
          <div class="mainline">
            <div class="skill-node" data-id="7">
              <div class="skill-circle locked" onclick="openSkill(7)">
                å°ˆé¡Œç™¼è¡¨
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å³å´ï¼šå…§å®¹å€åŸŸ -->
    <div class="content-section" id="contentSection">
      <!-- åˆå§‹æ­¡è¿è¨Šæ¯ -->
      <div class="welcome-message" id="welcomeMessage">
        <div class="welcome-icon">ğŸ‘ˆ</div>
        <div class="welcome-text">é»æ“Šå·¦å´æŠ€èƒ½æ¨¹é–‹å§‹å­¸ç¿’</div>
      </div>

      <!-- å½±ç‰‡éšæ®µ -->
      <div id="videoStage" style="display: none;">
        <div class="content-header">
          <h2 class="content-title" id="contentTitle">èª²ç¨‹åç¨±</h2>
          <p class="content-subtitle">è§€çœ‹æ•™å­¸å½±ç‰‡ï¼Œå®Œæˆå¾Œé€²è¡Œè©•é‡</p>
        </div>
        <div class="video-container">
          <div class="video-placeholder">
            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ¬</div>
            <div>æ•™å­¸å½±ç‰‡é ç•™å€åŸŸ</div>
            <div style="font-size: 14px; color: #999; margin-top: 10px;">å½±ç‰‡è£½ä½œä¸­...</div>
          </div>
        </div>
        <button class="continue-btn" onclick="startQuiz()">é–‹å§‹è©•é‡ â†’</button>
      </div>

      <!-- è©•é‡éšæ®µ -->
      <div id="quizStage" class="quiz-container">
        <div class="content-header">
          <h2 class="content-title">ğŸ“ èª²ç¨‹è©•é‡</h2>
          <p class="content-subtitle">å®Œæˆæ‰€æœ‰é¡Œç›®ï¼Œé”åˆ° 100% æ­£ç¢ºç‡å³å¯è§£é–ä¸‹ä¸€é—œ</p>
        </div>
        <div id="quizContent" style="flex: 1; overflow-y: auto;"></div>
        <button class="submit-btn" id="submitBtn" onclick="submitQuiz()">æäº¤ç­”æ¡ˆ</button>
        <div id="resultMessage"></div>
      </div>
    </div>
  </div>

  <!-- åœ–ä¾‹ -->
  <div class="legend">
    <div class="legend-title">æŠ€èƒ½ç‹€æ…‹</div>
    <div class="legend-item">
      <div class="legend-circle main locked"></div>
      <span>æœªè§£é–</span>
    </div>
    <div class="legend-item">
      <div class="legend-circle main available"></div>
      <span>ä¸»ç·šå¯å­¸ç¿’</span>
    </div>
    <div class="legend-item">
      <div class="legend-circle side available"></div>
      <span>æ”¯ç·šå¯å­¸ç¿’</span>
    </div>
    <div class="legend-item">
      <div class="legend-circle main completed"></div>
      <span>ä¸»ç·šå·²å®Œæˆ</span>
    </div>
    <div class="legend-item">
      <div class="legend-circle side completed"></div>
      <span>æ”¯ç·šå·²å®Œæˆ</span>
    </div>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxLFE5c5m2Y4rAr3H6eIlPF06UhQK6n4IY0iLIl8jTSzXxdCxWxhK5eE9C4DLefn-IN/exec';

    // å–å¾—ç•¶å‰ç™»å…¥ä½¿ç”¨è€…
    let currentUser = null;
    try {
    const userData = localStorage.getItem('currentUser');
    if (userData) {
        currentUser = JSON.parse(userData);
        console.log('âœ… è®€å–åˆ°ä½¿ç”¨è€…:', currentUser);  // ğŸ”¥ åŠ å…¥é™¤éŒ¯è¨Šæ¯
    } else {
        console.log('âš ï¸ localStorage ä¸­æ²’æœ‰ currentUser');
    }
    } catch (e) {
    console.error('âŒ è®€å–ä½¿ç”¨è€…å¤±æ•—:', e);
    }

    // è¤‡è£½ç™»å…¥é é¢çš„ makeRequest å‡½æ•¸
    function makeRequest(data) {
    return new Promise((resolve, reject) => {
        const callbackName = 'jsonp_' + Date.now() + '_' + Math.floor(Math.random() * 100000);
        
        window[callbackName] = function(response) {
        console.log('API å›æ‡‰:', response);
        delete window[callbackName];
        if (script && script.parentNode) {
            script.parentNode.removeChild(script);
        }
        resolve(response);
        };
        
        const params = new URLSearchParams({
        callback: callbackName,
        ...data
        });
        
        const script = document.createElement('script');
        script.src = `${SCRIPT_URL}?${params.toString()}`;
        script.onerror = () => {
        delete window[callbackName];
        reject(new Error('è«‹æ±‚å¤±æ•—'));
        };
        
        document.body.appendChild(script);
        
        setTimeout(() => {
        if (window[callbackName]) {
            delete window[callbackName];
            reject(new Error('è«‹æ±‚è¶…æ™‚'));
        }
        }, 15000);
    });
    }

    // æŠ€èƒ½è³‡æ–™
    const skills = {
      1: { 
        name: 'åŸºç¤ä»‹ç´¹', 
        type: 'main',
        videoId:'f2SRmh8cOBU',
        quiz: [
          { q: 'App Inventor æ˜¯ä»€éº¼ï¼Ÿ', options: ['ç¶²é é–‹ç™¼å·¥å…·', 'æ‰‹æ©Ÿæ‡‰ç”¨ç¨‹å¼é–‹ç™¼å¹³å°', 'éŠæˆ²å¼•æ“', 'ç¹ªåœ–è»Ÿé«”'], correct: 1 },
          { q: 'App Inventor ä½¿ç”¨ä»€éº¼æ–¹å¼ç·¨ç¨‹ï¼Ÿ', options: ['æ–‡å­—ç¨‹å¼ç¢¼', 'æ‹–æ›³ç©æœ¨', 'æ‰‹ç¹ªæµç¨‹åœ–', 'èªéŸ³æŒ‡ä»¤'], correct: 1 }
        ]
      },
      2: { 
        name: 'ä»‹é¢è¨­è¨ˆ', 
        type: 'main',
        quiz: [
          { q: 'ä»‹é¢è¨­è¨ˆæœ€é‡è¦çš„åŸå‰‡æ˜¯ï¼Ÿ', options: ['ç¾è§€', 'åŠŸèƒ½æ€§', 'ä½¿ç”¨è€…é«”é©—', 'ä»¥ä¸Šçš†æ˜¯'], correct: 3 }
        ]
      },
      3: { 
        name: 'éŸ³æ•ˆè¨­è¨ˆ', 
        type: 'side',
        quiz: [
          { q: 'å¥½çš„éŠæˆ²éŸ³æ•ˆå¯ä»¥ï¼Ÿ', options: ['å¢åŠ éŠæˆ²è¶£å‘³', 'æä¾›å›é¥‹', 'ç‡Ÿé€ æ°›åœ', 'ä»¥ä¸Šçš†æ˜¯'], correct: 3 }
        ]
      },
      4: { 
        name: 'ç¨‹å¼é‚è¼¯', 
        type: 'main',
        quiz: [
          { q: 'ç¨‹å¼é‚è¼¯ä¸­æœ€åŸºæœ¬çš„çµæ§‹æ˜¯ï¼Ÿ', options: ['é †åºçµæ§‹', 'é¸æ“‡çµæ§‹', 'è¿´åœˆçµæ§‹', 'ä»¥ä¸Šçš†æ˜¯'], correct: 3 }
        ]
      },
      5: { 
        name: 'è³‡æ–™å„²å­˜', 
        type: 'side',
        quiz: [
          { q: 'App å¯ä»¥ä½¿ç”¨ä»€éº¼æ–¹å¼å„²å­˜è³‡æ–™ï¼Ÿ', options: ['TinyDB', 'é›²ç«¯è³‡æ–™åº«', 'æª”æ¡ˆå„²å­˜', 'ä»¥ä¸Šçš†æ˜¯'], correct: 3 }
        ]
      },
      6: { 
        name: 'éŠæˆ²è£½ä½œ', 
        type: 'main',
        quiz: [
          { q: 'è£½ä½œéŠæˆ²éœ€è¦è€ƒæ…®å“ªäº›è¦ç´ ï¼Ÿ', options: ['éŠæˆ²è¦å‰‡', 'è¨ˆåˆ†ç³»çµ±', 'é›£åº¦è¨­è¨ˆ', 'ä»¥ä¸Šçš†æ˜¯'], correct: 3 }
        ]
      },
      7: { 
        name: 'å°ˆé¡Œç™¼è¡¨', 
        type: 'main',
        quiz: [
          { q: 'ç™¼è¡¨å°ˆé¡Œæ™‚æ‡‰è©²åŒ…å«ï¼Ÿ', options: ['ä½œå“å±•ç¤º', 'è¨­è¨ˆç†å¿µ', 'æŠ€è¡“èªªæ˜', 'ä»¥ä¸Šçš†æ˜¯'], correct: 3 }
        ]
      },
      8: { 
        name: 'é€²éšéŸ³æ•ˆ', 
        type: 'side',
        quiz: [
          { q: 'é€²éšéŸ³æ•ˆæŠ€è¡“åŒ…æ‹¬ï¼Ÿ', options: ['3DéŸ³æ•ˆ', 'å‹•æ…‹éŸ³é‡', 'éŸ³æ•ˆæ··åˆ', 'ä»¥ä¸Šçš†æ˜¯'], correct: 3 }
        ]
      }
    };

    // é€£æ¥é—œä¿‚ï¼ˆfrom -> toï¼‰
    const connections = [
    // ä¸»ç·šé€£æ¥ï¼ˆé‡‘è‰²ï¼‰
    { from: 1, to: 2, type: 'main' },
    { from: 2, to: 4, type: 'main' },
    { from: 4, to: 6, type: 'main' },
    { from: 6, to: 7, type: 'main' },
    
    // æ”¯ç·šé€£æ¥åˆ°åŒå±¤ä¸»ç·šï¼ˆç´«è‰²ï¼‰
    { from: 2, to: 3, type: 'side' },  // ä»‹é¢è¨­è¨ˆ â†’ éŸ³æ•ˆè¨­è¨ˆ
    { from: 4, to: 5, type: 'side' },  // ç¨‹å¼é‚è¼¯ â†’ è³‡æ–™å„²å­˜
    { from: 6, to: 8, type: 'side' }   // éŠæˆ²è£½ä½œ â†’ é€²éšéŸ³æ•ˆ
    ];

    let currentSkillId = null;
    let userAnswers = [];
    let completedSkills = new Set();
    let currentAttempts = 1;  // ğŸ”¥ æ–°å¢:è¿½è¹¤ç•¶å‰æŠ€èƒ½çš„å˜—è©¦æ¬¡æ•¸

    // ç¹ªè£½é€£æ¥ç·š
    function drawConnections() {
    const svg = document.getElementById('connectionsSvg');
    svg.innerHTML = '';
    
    // ç¢ºä¿ SVG æœ‰æ­£ç¢ºçš„å°ºå¯¸
    const treeSection = document.querySelector('.skill-tree-section');
    svg.style.width = treeSection.scrollWidth + 'px';
    svg.style.height = treeSection.scrollHeight + 'px';
    
    connections.forEach(conn => {
        const fromNode = document.querySelector(`[data-id="${conn.from}"]`);
        const toNode = document.querySelector(`[data-id="${conn.to}"]`);
        
        if (!fromNode || !toNode) {
        console.log(`æ‰¾ä¸åˆ°ç¯€é»: from=${conn.from}, to=${conn.to}`);
        return;
        }
        
        const fromCircle = fromNode.querySelector('.skill-circle');
        const toCircle = toNode.querySelector('.skill-circle');
        
        if (!fromCircle || !toCircle) {
        console.log(`æ‰¾ä¸åˆ°åœ“åœˆ: from=${conn.from}, to=${conn.to}`);
        return;
        }
        
        const fromRect = fromCircle.getBoundingClientRect();
        const toRect = toCircle.getBoundingClientRect();
        const containerRect = treeSection.getBoundingClientRect();
        
        // è¨ˆç®—ç›¸å°æ–¼ skill-tree-section çš„åº§æ¨™
        const x1 = fromRect.left + fromRect.width / 2 - containerRect.left + treeSection.scrollLeft;
        const y1 = fromRect.top + fromRect.height / 2 - containerRect.top + treeSection.scrollTop;
        const x2 = toRect.left + toRect.width / 2 - containerRect.left + treeSection.scrollLeft;
        const y2 = toRect.top + toRect.height / 2 - containerRect.top + treeSection.scrollTop;
        
        console.log(`ç¹ªè£½ç·šæ¢: ${conn.from} â†’ ${conn.to}, (${x1},${y1}) â†’ (${x2},${y2})`);
        
        // æ·»åŠ ç™¼å…‰æ•ˆæœ
        const glow = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        glow.setAttribute('x1', x1);
        glow.setAttribute('y1', y1);
        glow.setAttribute('x2', x2);
        glow.setAttribute('y2', y2);
        glow.setAttribute('stroke', conn.type === 'main' ? '#ffd700' : '#a855f7');
        glow.setAttribute('stroke-width', conn.type === 'main' ? '12' : '8');
        glow.setAttribute('opacity', '0.2');
        glow.setAttribute('stroke-linecap', 'round');
        glow.setAttribute('filter', 'blur(4px)');
        
        svg.appendChild(glow);
        
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', x1);
        line.setAttribute('y1', y1);
        line.setAttribute('x2', x2);
        line.setAttribute('y2', y2);
        
        // ä¸»ç·šç”¨é‡‘è‰²ç²—ç·šï¼Œæ”¯ç·šç”¨ç´«è‰²ç´°ç·š
        if (conn.type === 'main') {
        line.setAttribute('stroke', '#ffd700');
        line.setAttribute('stroke-width', '6');
        line.setAttribute('stroke-dasharray', '10,5');
        } else {
        line.setAttribute('stroke', '#a855f7');
        line.setAttribute('stroke-width', '4');
        line.setAttribute('stroke-dasharray', '8,4');
        }
        
        line.setAttribute('opacity', '0.7');
        line.setAttribute('stroke-linecap', 'round');
        
        svg.appendChild(line);
    });
    }

    // é é¢è¼‰å…¥å¾Œç¹ªè£½é€£æ¥ç·š
    window.addEventListener('load', () => {
    setTimeout(drawConnections, 200);
    });

    window.addEventListener('resize', () => {
    setTimeout(drawConnections, 100);
    });

    // é é¢è¼‰å…¥å¾Œç¹ªè£½é€£æ¥ç·š
    window.addEventListener('load', () => {
      setTimeout(drawConnections, 100);
    });

    window.addEventListener('resize', drawConnections);

    function openSkill(id) {
    const node = document.querySelector(`[data-id="${id}"]`);
    const circle = node.querySelector('.skill-circle');
    
    if (circle.classList.contains('locked')) {
        alert('è«‹å…ˆå®Œæˆå‰é¢çš„èª²ç¨‹ï¼');
        return;
    }
    
    currentSkillId = id;
    videoWatched = false;  // é‡ç½®å½±ç‰‡è§€çœ‹ç‹€æ…‹
    window.skillStartTime = new Date();
    currentAttempts = 1;
    
    // éš±è—æ­¡è¿è¨Šæ¯
    document.getElementById('welcomeMessage').style.display = 'none';
    
    // é¡¯ç¤ºå½±ç‰‡éšæ®µ
    document.getElementById('videoStage').style.display = 'block';
    document.getElementById('quizStage').classList.remove('active');
    document.getElementById('quizStage').style.display = 'none';
    
    // è¨­å®šæ¨™é¡Œ
    document.getElementById('contentTitle').textContent = skills[id].name;
    
    // è¼‰å…¥ YouTube å½±ç‰‡
    loadYouTubeVideo(id);
    
    // é‡ç½®çµæœè¨Šæ¯
    document.getElementById('resultMessage').innerHTML = '';
    
    // æ²å‹•åˆ°å³å´å…§å®¹å€åŸŸé ‚éƒ¨
    document.getElementById('contentSection').scrollTop = 0;
    }

    // è¼‰å…¥ YouTube å½±ç‰‡å‡½æ•¸
    function loadYouTubeVideo(id) {
    const videoContainer = document.querySelector('.video-container');
    const skill = skills[id];
    
    if (skill.videoId) {
        // æœ‰ YouTube å½±ç‰‡ IDï¼Œé¡¯ç¤ºåµŒå…¥å½±ç‰‡
        videoContainer.innerHTML = `
        <iframe 
            id="youtubePlayer"
            width="100%" 
            height="100%" 
            src="https://www.youtube.com/embed/${skill.videoId}?enablejsapi=1&rel=0" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen
            style="border-radius: 12px;">
        </iframe>
        `;
        
        // 5ç§’å¾Œè‡ªå‹•æ¨™è¨˜ç‚ºå·²è§€çœ‹ï¼ˆå¯èª¿æ•´ï¼‰
        setTimeout(() => {
        videoWatched = true;
        updateContinueButton();
        }, 5000);
    } else {
        // æ²’æœ‰å½±ç‰‡ IDï¼Œé¡¯ç¤ºé ç•™å€åŸŸ
        videoContainer.innerHTML = `
        <div class="video-placeholder">
            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ¬</div>
            <div>æ•™å­¸å½±ç‰‡é ç•™å€åŸŸ</div>
            <div style="font-size: 14px; color: #999; margin-top: 10px;">å½±ç‰‡è£½ä½œä¸­...</div>
        </div>
        `;
        
        // å¦‚æœæ²’æœ‰å½±ç‰‡ï¼Œç›´æ¥æ¨™è¨˜ç‚ºå·²è§€çœ‹
        videoWatched = true;
        updateContinueButton();
    }
    //å‘¼å« API è¨˜éŒ„é–‹å§‹å­¸ç¿’
    if (currentUser) {
        makeRequest({
            action: 'saveProgress',
            userId: currentUser.userId,
            email: currentUser.email,
            skillId: id,
            skillName: skills[id].name,
            startTime: window.skillStartTime.toLocaleString('zh-TW'),
            status: 'started',
            attempts: 1
        }).then(() => {
            console.log('âœ… å·²è¨˜éŒ„é–‹å§‹å­¸ç¿’');
        }).catch(err => {
            console.error('âŒ è¨˜éŒ„å¤±æ•—:', err);
        });
    }
    }

    // æ›´æ–°ç¹¼çºŒæŒ‰éˆ•ç‹€æ…‹
    function updateContinueButton() {
    const continueBtn = document.querySelector('.continue-btn');
    if (videoWatched) {
        continueBtn.disabled = false;
        continueBtn.style.opacity = '1';
        continueBtn.style.cursor = 'pointer';
    } else {
        continueBtn.disabled = true;
        continueBtn.style.opacity = '0.5';
        continueBtn.style.cursor = 'not-allowed';
    }
    }

    function startQuiz() {
    if (!videoWatched) {
        alert('è«‹å…ˆè§€çœ‹å®Œæ•™å­¸å½±ç‰‡ï¼');
        return;
    }

    if (currentUser && window.skillStartTime) {
    const watchDuration = Math.floor((new Date() - window.skillStartTime) / 1000); // ç§’æ•¸
    
    makeRequest({
      action: 'saveVideoWatch',
      userId: currentUser.userId,
      email: currentUser.email,
      videoId: currentSkillId,
      videoTitle: skills[currentSkillId].name,
      watchDuration: watchDuration,
      totalDuration: watchDuration  // å¦‚æœçŸ¥é“å½±ç‰‡ç¸½é•·åº¦å¯ä»¥æ”¹æˆå¯¦éš›å€¼
    }).then(() => {
      console.log('âœ… å·²è¨˜éŒ„å½±ç‰‡è§€çœ‹');
    }).catch(err => {
      console.error('âŒ è¨˜éŒ„å¤±æ•—:', err);
    });
    }

    // åœæ­¢ YouTube å½±ç‰‡
    stopYouTubeVideo();
    
    document.getElementById('videoStage').style.display = 'none';
    document.getElementById('quizStage').classList.add('active');
    document.getElementById('quizStage').style.display = 'flex';
    
    const quiz = skills[currentSkillId].quiz;
    let html = '';
    
    quiz.forEach((q, index) => {
        html += `
        <div class="question">
            <div class="question-text">${index + 1}. ${q.q}</div>
            <div class="options">
            ${q.options.map((opt, i) => `
                <div class="option" onclick="selectOption(${index}, ${i})">
                <input type="radio" name="q${index}" value="${i}" id="q${index}_${i}">
                ${opt}
                </div>
            `).join('')}
            </div>
        </div>
        `;
    });
    
    document.getElementById('quizContent').innerHTML = html;
    document.getElementById('submitBtn').disabled = false;
    document.getElementById('resultMessage').innerHTML = '';
    userAnswers = new Array(quiz.length).fill(null);
    
    // æ²å‹•åˆ°å…§å®¹å€åŸŸé ‚éƒ¨
    document.getElementById('contentSection').scrollTop = 0;
    }

    // æ–°å¢ï¼šåœæ­¢ YouTube å½±ç‰‡å‡½æ•¸
    function stopYouTubeVideo() {
    const iframe = document.getElementById('youtubePlayer');
    if (iframe) {
        // æ–¹æ³•1ï¼šç§»é™¤ä¸¦é‡æ–°å»ºç«‹ iframeï¼ˆæœ€å¯é ï¼‰
        const videoContainer = document.querySelector('.video-container');
        videoContainer.innerHTML = `
        <div class="video-placeholder">
            <div style="font-size: 48px; margin-bottom: 15px;">âœ“</div>
            <div>å½±ç‰‡å·²åœæ­¢</div>
            <div style="font-size: 14px; color: #999; margin-top: 10px;">è«‹å®Œæˆè©•é‡</div>
        </div>
        `;
    }
    }

    function selectOption(questionIndex, optionIndex) {
    userAnswers[questionIndex] = optionIndex;
    
    // é¸å–å°æ‡‰çš„ radio button
    const radioBtn = document.getElementById(`q${questionIndex}_${optionIndex}`);
    if (radioBtn) {
        radioBtn.checked = true;
    }
    
    // æ›´æ–°é¸é …æ¨£å¼
    const options = document.querySelectorAll(`.question:nth-child(${questionIndex + 1}) .option`);
    options.forEach((opt, i) => {
        if (i === optionIndex) {
        opt.classList.add('selected');
        } else {
        opt.classList.remove('selected');
        }
    });
    }

    function submitQuiz() {
    const quiz = skills[currentSkillId].quiz;
    
    if (userAnswers.includes(null)) {
        alert('è«‹å›ç­”æ‰€æœ‰é¡Œç›®ï¼');
        return;
    }

    let correctCount = 0;
    quiz.forEach((q, index) => {
        const options = document.querySelectorAll(`.question:nth-child(${index + 1}) .option`);
        if (userAnswers[index] === q.correct) {
        correctCount++;
        options[userAnswers[index]].classList.add('correct');
        } else {
        options[userAnswers[index]].classList.add('wrong');
        options[q.correct].classList.add('correct');
        }
    });

    const percentage = (correctCount / quiz.length) * 100;

    // è¨˜éŒ„æ¸¬é©—çµæœ
    if (currentUser) {
        makeRequest({
        action: 'saveQuizResult',
        userId: currentUser.userId,
        email: currentUser.email,
        quizId: currentSkillId,
        quizName: skills[currentSkillId].name,
        score: Math.round(percentage),
        totalQuestions: quiz.length,
        correctAnswers: correctCount
        }).then(() => {
        console.log('âœ… å·²è¨˜éŒ„æ¸¬é©—çµæœ');
        }).catch(err => {
        console.error('âŒ è¨˜éŒ„å¤±æ•—:', err);
        });
    }

    if (percentage === 100) {
        // é¡¯ç¤ºæˆåŠŸæ‡¸æµ®è¦–çª—
        showSuccessModal();
    } else {
        currentAttempts++;
        console.log(`å˜—è©¦æ¬¡æ•¸: ${currentAttempts}`);
        showFailModal(percentage);
    }
    
    document.getElementById('submitBtn').disabled = true;
    }

    // é¡¯ç¤ºæˆåŠŸæ‡¸æµ®è¦–çª—
    function showSuccessModal() {
    // å‰µå»ºæ‡¸æµ®è¦–çª—
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.innerHTML = `
        <div class="modal-content">
        <div class="modal-icon">ğŸ‰</div>
        <div class="modal-title">å¤ªæ£’äº†ï¼</div>
        <div class="modal-message">
            æ­å–œå®Œæˆã€Œ${skills[currentSkillId].name}ã€èª²ç¨‹ï¼<br>
            æ­£ç¢ºç‡ï¼š100%
        </div>
        <button class="modal-btn" onclick="closeSuccessModal()">é ˜å–çå‹µä¸¦ç¹¼çºŒ</button>
        </div>
    `;
    document.body.appendChild(modal);
    
    // æ·»åŠ ç…™ç«ç‰¹æ•ˆ
    createFireworks(modal);
    
    // æ·»åŠ æ˜Ÿæ˜Ÿé£„è½ç‰¹æ•ˆ
    createStars(modal);
    }

    // å‰µå»ºç…™ç«ç‰¹æ•ˆ
    function createFireworks(container) {
    const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#ff9ff3', '#54a0ff'];
    
    for (let i = 0; i < 5; i++) {
        setTimeout(() => {
        const fireworkContainer = document.createElement('div');
        fireworkContainer.style.position = 'absolute';
        fireworkContainer.style.left = Math.random() * 100 + '%';
        fireworkContainer.style.top = Math.random() * 100 + '%';
        
        for (let j = 0; j < 30; j++) {
            const particle = document.createElement('div');
            particle.className = 'firework';
            particle.style.background = colors[Math.floor(Math.random() * colors.length)];
            
            const angle = (Math.PI * 2 * j) / 30;
            const velocity = 50 + Math.random() * 50;
            particle.style.setProperty('--tx', Math.cos(angle) * velocity + 'px');
            particle.style.setProperty('--ty', Math.sin(angle) * velocity + 'px');
            
            fireworkContainer.appendChild(particle);
        }
        
        container.appendChild(fireworkContainer);
        
        setTimeout(() => fireworkContainer.remove(), 1000);
        }, i * 200);
    }
    }

    // å‰µå»ºæ˜Ÿæ˜Ÿé£„è½ç‰¹æ•ˆ
    function createStars(container) {
    const stars = ['â­', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«'];
    
    for (let i = 0; i < 20; i++) {
        setTimeout(() => {
        const star = document.createElement('div');
        star.className = 'star';
        star.textContent = stars[Math.floor(Math.random() * stars.length)];
        star.style.left = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 2 + 's';
        star.style.animationDuration = (2 + Math.random() * 2) + 's';
        
        container.appendChild(star);
        
        setTimeout(() => star.remove(), 4000);
        }, i * 100);
    }
    }

    // é—œé–‰æˆåŠŸæ‡¸æµ®è¦–çª—
    function closeSuccessModal() {
    const modal = document.querySelector('.modal-overlay');
    if (modal) {
        modal.classList.remove('active');
        setTimeout(() => modal.remove(), 300);
    }
    
    // å®ŒæˆæŠ€èƒ½
    completeSkill();
    }

    // é¡¯ç¤ºå¤±æ•—æ‡¸æµ®è¦–çª—
    function showFailModal(percentage) {
    // å‰µå»ºæ‡¸æµ®è¦–çª—
    const modal = document.createElement('div');
    modal.className = 'modal-overlay active';
    modal.innerHTML = `
        <div class="modal-content fail">
        <div class="modal-icon">ğŸ˜¢</div>
        <div class="modal-title">å†æ¥å†å²ï¼</div>
        <div class="modal-message">
            ã€Œ${skills[currentSkillId].name}ã€èª²ç¨‹<br>
            æ­£ç¢ºç‡ï¼š${percentage}%<br>
            éœ€è¦é”åˆ° 100% æ‰èƒ½é€šéå–”ï¼
        </div>
        <button class="modal-btn" onclick="closeFailModal()">é‡æ–°æŒ‘æˆ°</button>
        </div>
    `;
    document.body.appendChild(modal);
    
    // æ·»åŠ é›¨æ»´ç‰¹æ•ˆ
    createRaindrops(modal);
    
    // æ·»åŠ ç¢ç‰‡ç‰¹æ•ˆ
    createFragments(modal);
    }

    // å‰µå»ºé›¨æ»´ç‰¹æ•ˆ
    function createRaindrops(container) {
    for (let i = 0; i < 30; i++) {
        setTimeout(() => {
        const raindrop = document.createElement('div');
        raindrop.className = 'raindrop';
        raindrop.style.left = Math.random() * 100 + '%';
        raindrop.style.animationDelay = Math.random() * 1 + 's';
        raindrop.style.animationDuration = (0.5 + Math.random() * 0.5) + 's';
        
        container.appendChild(raindrop);
        
        setTimeout(() => raindrop.remove(), 2000);
        }, i * 50);
    }
    }

    // å‰µå»ºç¢ç‰‡ç‰¹æ•ˆ
    function createFragments(container) {
    const modalContent = container.querySelector('.modal-content');
    const rect = modalContent.getBoundingClientRect();
    
    for (let i = 0; i < 20; i++) {
        setTimeout(() => {
        const fragment = document.createElement('div');
        fragment.className = 'fragment';
        fragment.style.left = '50%';
        fragment.style.top = '50%';
        
        const angle = (Math.PI * 2 * i) / 20;
        const distance = 100 + Math.random() * 100;
        fragment.style.setProperty('--fx', Math.cos(angle) * distance + 'px');
        fragment.style.setProperty('--fy', Math.sin(angle) * distance + 'px');
        fragment.style.setProperty('--fr', Math.random() * 360 + 'deg');
        
        container.appendChild(fragment);
        
        setTimeout(() => fragment.remove(), 2000);
        }, i * 30);
    }
    }

    // é—œé–‰å¤±æ•—æ‡¸æµ®è¦–çª—
    function closeFailModal() {
    const modal = document.querySelector('.modal-overlay');
    if (modal) {
        modal.classList.remove('active');
        setTimeout(() => modal.remove(), 300);
    }
    
    // é‡æ–°é–‹å§‹æ¸¬é©—
    retryQuiz();
    
    }

    function retryQuiz() {
    // åœæ­¢å½±ç‰‡
    stopYouTubeVideo();
    
    // é‡æ–°é–‹å•Ÿç•¶å‰æŠ€èƒ½
    const id = currentSkillId;
    currentSkillId = null;
    userAnswers = [];
    videoWatched = false;
    
    // é‡æ–°é¡¯ç¤ºå½±ç‰‡éšæ®µ
    document.getElementById('quizStage').style.display = 'none';
    document.getElementById('videoStage').style.display = 'block';
    document.getElementById('resultMessage').innerHTML = '';
    document.getElementById('contentSection').scrollTop = 0;
    
    currentSkillId = id;
    
    // é‡æ–°è¼‰å…¥å½±ç‰‡
    loadYouTubeVideo(id);
    }

    function completeSkill() {
      const node = document.querySelector(`[data-id="${currentSkillId}"]`);
      const circle = node.querySelector('.skill-circle');
      circle.classList.remove('available');
      circle.classList.add('completed');
      completedSkills.add(currentSkillId);
      
    // è¨˜éŒ„å®Œæˆèª²ç¨‹ä¸¦æ›´æ–°çµ±è¨ˆ
    if (currentUser && window.skillStartTime) {
        const completeTime = new Date();
        const learningMinutes = Math.floor((completeTime - window.skillStartTime) / 60000);

        // æ›´æ–°é€²åº¦ç‚ºå®Œæˆ
        makeRequest({
            action: 'saveProgress',
            userId: currentUser.userId,
            email: currentUser.email,
            skillId: currentSkillId,
            skillName: skills[currentSkillId].name,
            skillType: skills[currentSkillId].type,
            startTime: window.skillStartTime.toLocaleString('zh-TW'),
            completeTime: completeTime.toLocaleString('zh-TW'),
            status: 'completed',
            score: 100,
            attempts: currentAttempts,
            learningMinutes: learningMinutes
        }).then(() => {
        console.log('âœ… å·²è¨˜éŒ„å®Œæˆç‹€æ…‹');
        });
        
        // æ›´æ–°ä½¿ç”¨è€…çµ±è¨ˆ
        makeRequest({
        action: 'updateUserStats',
        userId: currentUser.userId,
        completedCourse: 'true',
        learningMinutes: learningMinutes
        }).then(() => {
        console.log('âœ… å·²æ›´æ–°ä½¿ç”¨è€…çµ±è¨ˆ');
        });
    }
      // è§£é–ä¸‹ä¸€å€‹æŠ€èƒ½
      unlockNextSkills(currentSkillId);
      
      // é‡æ–°ç¹ªè£½é€£æ¥ç·š
      drawConnections();
      
      // è¿”å›åˆå§‹ç‹€æ…‹
      document.getElementById('videoStage').style.display = 'none';
      document.getElementById('quizStage').style.display = 'none';
      document.getElementById('welcomeMessage').style.display = 'flex';
      
      currentSkillId = null;
      userAnswers = [];
    }

    function unlockNextSkills(completedId) {
    const unlockMap = {
        1: [2, 3],      // å®ŒæˆåŸºç¤ä»‹ç´¹ â†’ è§£é–ä»‹é¢è¨­è¨ˆå’ŒéŸ³æ•ˆè¨­è¨ˆ
        2: [4],         // å®Œæˆä»‹é¢è¨­è¨ˆ â†’ è§£é–ç¨‹å¼é‚è¼¯
        3: [],          // éŸ³æ•ˆè¨­è¨ˆä¸è§£é–å…¶ä»–
        4: [5, 6],      // å®Œæˆç¨‹å¼é‚è¼¯ â†’ è§£é–è³‡æ–™å„²å­˜å’ŒéŠæˆ²è£½ä½œ
        5: [],          // è³‡æ–™å„²å­˜ä¸è§£é–å…¶ä»–
        6: [7, 8],      // å®ŒæˆéŠæˆ²è£½ä½œ â†’ è§£é–å°ˆé¡Œç™¼è¡¨å’Œé€²éšéŸ³æ•ˆ
        7: [],          // å°ˆé¡Œç™¼è¡¨ï¼ˆæœ€çµ‚ï¼‰
        8: []           // é€²éšéŸ³æ•ˆä¸è§£é–å…¶ä»–
    };
    
    const toUnlock = unlockMap[completedId] || [];
    toUnlock.forEach(id => {
        const node = document.querySelector(`[data-id="${id}"]`);
        if (node) {
        const circle = node.querySelector('.skill-circle');
        if (circle && circle.classList.contains('locked')) {
            // æª¢æŸ¥å‰ç½®æ¢ä»¶
            if (canUnlock(id)) {
            circle.classList.remove('locked');
            circle.classList.add('available');
            }
        }
        }
    });
    }

    function canUnlock(skillId) {
    // å®šç¾©æ¯å€‹æŠ€èƒ½çš„å‰ç½®æ¢ä»¶ï¼ˆå¿…é ˆå®Œæˆçš„æŠ€èƒ½ï¼‰
    const prerequisites = {
        2: [1],         // ä»‹é¢è¨­è¨ˆéœ€è¦åŸºç¤ä»‹ç´¹
        3: [1],         // éŸ³æ•ˆè¨­è¨ˆéœ€è¦åŸºç¤ä»‹ç´¹
        4: [2],         // ç¨‹å¼é‚è¼¯éœ€è¦ä»‹é¢è¨­è¨ˆ
        5: [4],         // è³‡æ–™å„²å­˜éœ€è¦ç¨‹å¼é‚è¼¯
        6: [4],         // éŠæˆ²è£½ä½œéœ€è¦ç¨‹å¼é‚è¼¯
        7: [6],         // å°ˆé¡Œç™¼è¡¨éœ€è¦éŠæˆ²è£½ä½œ
        8: [6]          // é€²éšéŸ³æ•ˆéœ€è¦éŠæˆ²è£½ä½œ
    };
    
    const required = prerequisites[skillId] || [];
    return required.every(id => completedSkills.has(id));
    }

// é é¢è¼‰å…¥æ™‚æ¢å¾©é€²åº¦
    window.onload = async function() {
    console.log('é é¢è¼‰å…¥å®Œæˆ');
    
    // ğŸ”¥ å…ˆæ›´æ–° UI
    if (currentUser) {
        updateHeaderUI();  // ç«‹å³æ›´æ–° Header é¡¯ç¤º
        
        // å†è¼‰å…¥å­¸ç¿’é€²åº¦
        try {
        const progressData = await makeRequest({
            action: 'getUserProgress',
            userId: currentUser.userId
        });
        
        if (progressData.success && progressData.data.completedSkills) {
            const completed = progressData.data.completedSkills;
            console.log('âœ… å·²å®Œæˆçš„æŠ€èƒ½:', completed);
            
            // æ¢å¾©å·²å®Œæˆç‹€æ…‹
            completed.forEach(skillId => {
            completedSkills.add(skillId);
            const node = document.querySelector(`[data-id="${skillId}"]`);
            if (node) {
                const circle = node.querySelector('.skill-circle');
                circle.classList.remove('locked', 'available');
                circle.classList.add('completed');
            }
            });
            
            // è§£é–ä¸‹ä¸€å€‹æŠ€èƒ½
            completed.forEach(skillId => {
            unlockNextSkills(skillId);
            });
            
            // é‡æ–°ç¹ªè£½é€£æ¥ç·š
            setTimeout(() => drawConnections(), 200);
        }
        } catch (err) {
        console.error('âŒ è¼‰å…¥é€²åº¦å¤±æ•—:', err);
        }
    }
    
    // ç­‰å¾…æŠ€èƒ½æ¨¹æ¸²æŸ“å®Œæˆå¾Œç¹ªè£½é€£æ¥ç·š
    setTimeout(() => drawConnections(), 200);
    };

    // æ›´æ–° Header UI
    function updateHeaderUI() {
    if (currentUser) {
        const navRight = document.getElementById('headerNav');
        if (navRight) {
        navRight.innerHTML = `
            <div style="display: flex; align-items: center; gap: 12px;">
            <img src="${currentUser.avatar}" alt="avatar" 
                style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid white;">
            <div style="color: white; text-align: left;">
                <div style="font-weight: bold; font-size: 14px;">${currentUser.displayName}</div>
                <div style="font-size: 11px; opacity: 0.85;">å®Œæˆ ${currentUser.completedCourses || 0} èª²ç¨‹</div>
            </div>
            <button class="nav-btn" onclick="logout()" 
                    style="background: rgba(255,255,255,0.1); color: white;">
                ç™»å‡º
            </button>
            </div>
        `;
        } else {
        console.error('âŒ æ‰¾ä¸åˆ° headerNav å…ƒç´ ');
        }
    }
    }

    function logout() {
    if (confirm('ç¢ºå®šè¦ç™»å‡ºå—?')) {
        localStorage.removeItem('currentUser');
        location.href = 'index.html';
    }
    }

  </script>
</body>
</html>